<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Online Library</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 24px; background: #f7f7f7; }
        h1 { margin-bottom: 8px; }
        section { background: #fff; padding: 16px; margin-bottom: 16px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
        label { display: block; margin: 6px 0 2px; }
        input { padding: 6px; width: 280px; }
        button { padding: 8px 14px; margin-top: 8px; cursor: pointer; }
        pre { background: #111; color: #e6e6e6; padding: 12px; border-radius: 6px; overflow-x: auto; }
        .row { display: flex; gap: 12px; flex-wrap: wrap; }
        .row input { width: 180px; }
        .message { margin-top: 8px; color: #0a6; }
        .error { color: #c00; }
    </style>
</head>
<body>
<h1>Online Library</h1>
<!--<p>Простой веб-интерфейс для работы с книгами и закладками. API живет на относительных путях <code>/api/books</code> и <code>/api/bookmarks</code>.</p>-->

<section>
    <h2>Книги</h2>
    <div class="row">
        <div>
            <h3>Создать книгу</h3>
            <label>Название</label>
            <input id="book-name" placeholder="Title" />
            <label>Путь (файл/ссылка)</label>
            <input id="book-path" placeholder="/books/file.pdf" />
            <button id="btn-create-book">Создать</button>
            <div id="msg-book" class="message"></div>
        </div>
        <div>
            <h3>Изменить книгу</h3>
            <label>ID книги</label>
            <input id="book-edit-id" type="number" min="1" />
            <label>Название</label>
            <input id="book-edit-name" placeholder="Title" />
            <label>Путь</label>
            <input id="book-edit-path" placeholder="/books/file.pdf" />
            <button id="btn-edit-book">Изменить</button>
            <div id="msg-book-edit" class="message"></div>
        </div>
        <div>
            <h3>Удалить книгу</h3>
            <label>ID книги</label>
            <input id="book-delete-id" type="number" min="1" />
            <button id="btn-delete-book">Удалить</button>
            <div id="msg-book-del" class="message"></div>
        </div>
    </div>
    <div style="margin-top:12px;">
        <button id="btn-load-books">Загрузить все книги</button>
    </div>
    <pre id="books-output">[]</pre>
</section>

<section>
    <h2>Закладки</h2>
    <div class="row">
        <div>
            <h3>Создать закладку</h3>
            <label>ID книги</label>
            <input id="bm-book-id" type="number" min="1" />
            <label>Страница</label>
            <input id="bm-page" type="number" min="0" />
            <button id="btn-create-bm">Создать</button>
            <div id="msg-bm" class="message"></div>
        </div>
        <div>
            <h3>Изменить закладку</h3>
            <label>ID закладки</label>
            <input id="bm-edit-id" type="number" min="1" />
            <label>ID книги</label>
            <input id="bm-edit-book-id" type="number" min="1" />
            <label>Страница</label>
            <input id="bm-edit-page" type="number" min="0" />
            <button id="btn-edit-bm">Изменить</button>
            <div id="msg-bm-edit" class="message"></div>
        </div>
        <div>
            <h3>Закладки книги</h3>
            <label>ID книги</label>
            <input id="bm-load-book-id" type="number" min="1" />
            <button id="btn-load-bm">Загрузить</button>
            <div id="msg-bm-load" class="message"></div>
        </div>
    </div>
    <div style="margin-top:12px;">
        <button id="btn-load-bm-all">Загрузить все закладки</button>
        <!-- <button id="btn-load-books">Загрузить все книги</button> -->
    </div>
    <pre id="bm-output">[]</pre>
</section>

<script>
const api = {
    books: '/api/books',
    bookmarks: '/api/bookmarks'
};

function setMessage(el, text, isError = false) {
    el.textContent = text;
    el.className = isError ? 'message error' : 'message';
}

async function textFetch(url, options = {}) {
    const resp = await fetch(url, options);
    const text = await resp.text();
    if (!resp.ok) throw new Error(text || resp.statusText);
    return text;
}

// Books
const bookName = document.getElementById('book-name');
const bookPath = document.getElementById('book-path');
const msgBook = document.getElementById('msg-book');
const msgBookDel = document.getElementById('msg-book-del');
const msgBookEdit = document.getElementById('msg-book-edit');
const booksOutput = document.getElementById('books-output');
const bookDeleteId = document.getElementById('book-delete-id');
const bookEditId = document.getElementById('book-edit-id');
const bookEditName = document.getElementById('book-edit-name');
const bookEditPath = document.getElementById('book-edit-path');

document.getElementById('btn-create-book').onclick = async () => {
    setMessage(msgBook, '');
    try {
        const body = new URLSearchParams({ name: bookName.value, path: bookPath.value });
        await textFetch(api.books, { method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body });
        setMessage(msgBook, 'Книга создана');
        bookName.value = '';
        bookPath.value = '';
    } catch (e) { setMessage(msgBook, e.message, true); }
};

document.getElementById('btn-edit-book').onclick = async () => {
    setMessage(msgBookEdit, '');
    const id = bookEditId.value;
    if (!id) return setMessage(msgBookEdit, 'Укажите ID', true);
    try {
        const body = new URLSearchParams({ name: bookEditName.value, path: bookEditPath.value });
        await textFetch(`${api.books}/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body });
        setMessage(msgBookEdit, 'Книга изменена');
        bookEditId.value = '';
        bookEditName.value = '';
        bookEditPath.value = '';
    } catch (e) { setMessage(msgBookEdit, e.message, true); }
};

document.getElementById('btn-load-books').onclick = async () => {
    try {
        const res = await textFetch(api.books);
        booksOutput.textContent = res || '(пусто)';
    } catch (e) { booksOutput.textContent = 'Ошибка: ' + e.message; }
};

document.getElementById('btn-delete-book').onclick = async () => {
    setMessage(msgBookDel, '');
    const id = bookDeleteId.value;
    if (!id) return setMessage(msgBookDel, 'Укажите ID', true);
    try {
        await textFetch(`${api.books}/${id}`, { method: 'DELETE' });
        setMessage(msgBookDel, 'Книга удалена');
        bookDeleteId.value = '';
    } catch (e) { setMessage(msgBookDel, e.message, true); }
};

// Bookmarks
const bmBookId = document.getElementById('bm-book-id');
const bmPage = document.getElementById('bm-page');
const bmLoadBookId = document.getElementById('bm-load-book-id');
const bmId = document.getElementById('bm-id');
const bmOutput = document.getElementById('bm-output');
const msgBm = document.getElementById('msg-bm');
const msgBmLoad = document.getElementById('msg-bm-load');
const msgBmEdit = document.getElementById('msg-bm-edit');
const bmEditId = document.getElementById('bm-edit-id');
const bmEditBookId = document.getElementById('bm-edit-book-id');
const bmEditPage = document.getElementById('bm-edit-page');

document.getElementById('btn-create-bm').onclick = async () => {
    setMessage(msgBm, '');
    try {
        const body = new URLSearchParams({ bookId: bmBookId.value, page: bmPage.value });
        await textFetch(api.bookmarks, { method: 'POST', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body });
        setMessage(msgBm, 'Закладка создана');
        bmBookId.value = '';
        bmPage.value = '';
    } catch (e) { setMessage(msgBm, e.message, true); }
};

document.getElementById('btn-edit-bm').onclick = async () => {
    setMessage(msgBmEdit, '');
    const id = bmEditId.value;
    if (!id) return setMessage(msgBmEdit, 'Укажите ID закладки', true);
    try {
        const body = new URLSearchParams({ bookId: bmEditBookId.value, page: bmEditPage.value });
        await textFetch(`${api.bookmarks}/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/x-www-form-urlencoded' }, body });
        setMessage(msgBmEdit, 'Закладка изменена');
        bmEditId.value = '';
        bmEditBookId.value = '';
        bmEditPage.value = '';
    } catch (e) { setMessage(msgBmEdit, e.message, true); }
};

document.getElementById('btn-load-bm-all').onclick = async () => {
    try {
        const res = await textFetch(api.bookmarks);
        bmOutput.textContent = res || '(пусто)';
    } catch (e) { bmOutput.textContent = 'Ошибка: ' + e.message; }
};

document.getElementById('btn-load-bm').onclick = async () => {
    const id = bmLoadBookId.value;
    if (!id) return setMessage(msgBmLoad, 'Укажите ID книги', true);
    setMessage(msgBmLoad, '');
    try {
        const res = await textFetch(`${api.bookmarks}?bookId=${id}`);
        bmOutput.textContent = res || '(пусто)';
    } catch (e) { bmOutput.textContent = 'Ошибка: ' + e.message; }
};

document.getElementById('btn-get-bm').onclick = async () => {
    const id = bmId.value;
    if (!id) return setMessage(msgBmLoad, 'Укажите ID закладки', true);
    try {
        const res = await textFetch(`${api.bookmarks}/${id}`);
        bmOutput.textContent = res || '(пусто)';
    } catch (e) { bmOutput.textContent = 'Ошибка: ' + e.message; }
};

document.getElementById('btn-del-bm').onclick = async () => {
    const id = bmId.value;
    if (!id) return setMessage(msgBmLoad, 'Укажите ID закладки', true);
    try {
        await textFetch(`${api.bookmarks}/${id}`, { method: 'DELETE' });
        bmOutput.textContent = 'Закладка удалена';
        bmId.value = '';
    } catch (e) { bmOutput.textContent = 'Ошибка: ' + e.message; }
};
</script>
</body>
</html>
